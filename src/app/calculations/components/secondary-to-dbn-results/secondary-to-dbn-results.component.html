<ng-container *ngIf="calculation">

  <div class="title">
    <h2>Sequence & secondary structure topology derived from file {{ calculation.filename }}</h2>
  </div>

  <div class="reanalyze">
    <app-reanalyze-panel>
      <app-secondary-to-dbn-params-form [params]="calculation.results[0].params" (paramChange)="onParamsChange($event)">
      </app-secondary-to-dbn-params-form>
      <mat-divider></mat-divider>
      <div class="submit">
        <button mat-raised-button color="primary" (click)="reanalyze()" [disabled]="loading">
          <div class="btn-content">
            <span *ngIf="!loading; else spinner">Run</span>
            <ng-template #spinner>
              <mat-spinner [diameter]="20"></mat-spinner>
            </ng-template>
          </div>
        </button>
      </div>
    </app-reanalyze-panel>
  </div>

  <div class="results">
    <div class="top-btns">
      <button mat-stroked-button (click)="selectAll()">Select all data</button>
      <button mat-stroked-button>Download selected</button>
    </div>
    <div class="result-panels">
      <div class="result" *ngFor="let result of calculation.results; let i = index">
        <div class="data-panel">
          <div><button mat-stroked-button (click)="selectThis(i)">Select this</button></div>
          <p>{{ getDescription(result.params) }}</p>
          <app-secondary-output [(ngModel)]="selected[i]" [output]="result.output"></app-secondary-output>
        </div>
        <div class="image-panel">
          <ng-container *ngIf="result.output.imageInformation.drawingResult === DrawingResult.DoneByMainDrawer">
            <app-checkbox [(ngModel)]="selected[i].imageInformation" label="Image" [showControls]="true" [indentation]="false" [expanded]="true">
              <p>Image generated by {{ result.output.imageInformation.successfulVisualizationTool }} procedure</p>
              <app-svg-viewer [src]="result.output.imageInformation.pathToSVGImage" [id]="i"></app-svg-viewer>
            </app-checkbox>
          </ng-container>
  
          <ng-container *ngIf="result.output.imageInformation.drawingResult === DrawingResult.DoneByBackupDrawer">
            <app-checkbox [(ngModel)]="selected[i].imageInformation" label="Image" [showControls]="true" [indentation]="false" [expanded]="true">
              <p>{{ result.output.imageInformation.failedVisualizationTool }} visualization failed. Image generated by {{ result.output.imageInformation.successfulVisualizationTool }} backup procedure</p>
              <app-svg-viewer [src]="result.output.imageInformation.pathToSVGImage" [id]="i"></app-svg-viewer>
            </app-checkbox>
          </ng-container>

          <ng-container *ngIf="result.output.imageInformation.drawingResult === DrawingResult.FailedByBothDrawers">
            <p>{{ result.output.imageInformation.failedVisualizationTool }} visualization failed. Please try again later.</p>
          </ng-container>

          <ng-container *ngIf="result.output.imageInformation.drawingResult === DrawingResult.NotDrawn">
            <p>Image not drawn.</p>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

</ng-container>